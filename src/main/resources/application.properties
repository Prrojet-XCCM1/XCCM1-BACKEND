# ==============================================================
# CONFIGURATION GÉNÉRALE
# ==============================================================
spring.application.name=xccm1
server.port=${PORT:8082}
spring.profiles.active=prod

# ==============================================================
# BASE DE DONNÉES (PostgreSQL)
# ==============================================================
spring.datasource.url=jdbc:postgresql://${DB_HOST:localhost}:${DB_PORT:5432}/${DB_NAME:xccm1}
spring.datasource.username=${DB_USERNAME}
spring.datasource.password=${DB_PASSWORD}
spring.datasource.driver-class-name=org.postgresql.Driver

# JPA / HIBERNATE
spring.jpa.hibernate.ddl-auto=update
spring.jpa.show-sql=false
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.PostgreSQLDialect
spring.jpa.properties.hibernate.jdbc.lob.non_contextual_creation=true
spring.jpa.open-in-view=false

# ==============================================================
# CONFIGURATION MAIL (Gmail SMTP SSL - Port 465)
# ==============================================================
# Le port 465 est souvent plus stable sur Render que le 587
spring.mail.host=74.125.140.108
spring.mail.port=465
spring.mail.username=${EMAIL_USERNAME}
spring.mail.password=${EMAIL_PASSWORD}

# Configuration SSL pour Gmail
spring.mail.properties.mail.smtp.auth=true
spring.mail.properties.mail.smtp.ssl.enable=true
spring.mail.properties.mail.smtp.ssl.trust=smtp.gmail.com
spring.mail.properties.mail.smtp.socketFactory.port=465
spring.mail.properties.mail.smtp.socketFactory.class=javax.net.ssl.SSLSocketFactory
spring.mail.properties.mail.smtp.socketFactory.fallback=false

# Timeouts de sécurité (Évite que l'app ne reste bloquée)
spring.mail.properties.mail.smtp.connectiontimeout=10000
spring.mail.properties.mail.smtp.timeout=10000
spring.mail.properties.mail.smtp.writetimeout=10000

# Désactiver le check au démarrage (Indispensable pour éviter les crashs si le SMTP met du temps à répondre)
management.health.mail.enabled=false

# ==============================================================
# GESTION DES LOGS
# ==============================================================
logging.level.org.hibernate=ERROR
logging.level.org.springframework.mail=DEBUG
logging.level.com.sun.mail.smtp=DEBUG
spring.mail.debug=true

# ==============================================================
# SÉCURITÉ JWT
# ==============================================================
application.security.jwt.secret-key=${JWT_SECRET:ce4f01beeee4257f8ae44276369cd65974b8e114a9103cdc738f01c391a9b023}
application.security.jwt.expiration=${JWT_EXPIRATION:86400000}
application.security.jwt.refresh-expiration=${JWT_REFRESH_EXPIRATION:604800000}

# ==============================================================
# AUTRES CONFIGURATIONS (Swagger, Files, Jackson)
# ==============================================================
spring.jackson.serialization.write-dates-as-timestamps=false
spring.jackson.time-zone=Europe/Paris

springdoc.api-docs.path=/v3/api-docs
springdoc.swagger-ui.path=/docs

spring.servlet.multipart.max-file-size=5MB
spring.servlet.multipart.max-request-size=5MB
file.upload-dir=${UPLOAD_DIR:./uploads}
